<!DOCTYPE html>
<html lang="en"><head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-5QTTTRNC1H"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-5QTTTRNC1H');
  </script>

  <meta property="og:image" content="https://discordapp.com/assets/ba74954dde74ff40a32ff58069e78c36.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="250">
  <meta property="og:image:height" content="250">

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>View Control for Design Option Elements 圖形取代設計選項中的物件顏色 | tailor . your . bim</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="View Control for Design Option Elements 圖形取代設計選項中的物件顏色" />
<meta name="author" content="Ching" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’m Ching, your BIM tailor." />
<meta property="og:description" content="I’m Ching, your BIM tailor." />
<link rel="canonical" href="http://localhost:4000/revitexternalcommand/View-Control-for-Design-Option-Elements/" />
<meta property="og:url" content="http://localhost:4000/revitexternalcommand/View-Control-for-Design-Option-Elements/" />
<meta property="og:site_name" content="tailor . your . bim" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-10-27T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="View Control for Design Option Elements 圖形取代設計選項中的物件顏色" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ching"},"dateModified":"2018-10-27T00:00:00+02:00","datePublished":"2018-10-27T00:00:00+02:00","description":"I’m Ching, your BIM tailor.","headline":"View Control for Design Option Elements 圖形取代設計選項中的物件顏色","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/revitexternalcommand/View-Control-for-Design-Option-Elements/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/logoty.png"},"name":"Ching"},"url":"http://localhost:4000/revitexternalcommand/View-Control-for-Design-Option-Elements/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
  <link rel="shortcut icon" type="image/png" href="assets/img/favicon.png"<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="tailor . your . bim" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><!-- <a class="site-title" rel="author" href="/">tailor . your . bim</a> -->

    <a class="site-title" rel="author" href="/">
      <img src="/assets/img/logoty.png" alt="Logo" width="28px"> 
      <span>&nbsp;&nbsp;tailor . your . bim</span>
        
      
      <!-- <span style='color: #B042FF;'>T</span>
      <span style='color: #939393;'>ailor . </span>
      <span style='color: #01bbd4;'>Y</span>
      <span style='color: #939393;'>our . BIM </span> -->
    </a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/categories/">Categories</a><a class="page-link" href="/contact/">Contact</a><a class="page-link" href="/tags/">Tags</a></div>
      </nav></div>
</header>

<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">View Control for Design Option Elements | 圖形取代設計選項中的物件顏色</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-10-27T00:00:00+02:00" itemprop="datePublished">Oct 27, 2018
      </time></p>
  </header>

  <div class="post-categories"><a herf="/categories/#RevitExternalCommand">RevitExternalCommand</a>&nbsp;|&nbsp;<a herf="/tags/#f#">f#</a>&nbsp;/&nbsp;<a herf="/tags/#revit api">revit api</a>&nbsp;/&nbsp;<a herf="/tags/#view">view</a>&nbsp;/&nbsp;<a herf="/tags/#design option">design option</a>&nbsp;/&nbsp;<a herf="/tags/#override graphic settings">override graphic settings</a></div>
  
  <div class="post-content e-content" itemprop="articleBody">
    <script src="/assets/signup/signup.js"></script>

<signup-component></signup-component>

<p>In this blog entry, let’s talk about how to handle the display of elements in views for example, giving different color to elements from the other similar elements. Here, I’ll demonstrate with an example: assigning distinctive colors to elements according to their different design options.</p>

<p>Sometimes, we have to work with DesignOptions for considering different design possibilities to improve our planing, and after a while, in the same model file, we might have many design options. In Revit’s default setting, in one single View, we can only show one of the Design Options in their group. Or we can select “automatic”, which shows the content of the Design Option which is currently being edited. It has a blind spot. We can distinguish the elements between different Design Option Groups, if they are similar in every other field, such as of the same category or of the same type.
We can however simply write a command to solve this problem.</p>

<p>接下來，來討論該操控物件（Element）在視圖中如何顯示的問題。譬如，給予與其他類似物件不同的顏色。這裏，我以一個例子來做說明：依據不同的設計選項群組，在同一視圖中，賦予不同的顏色。</p>

<p>時常，我們需要利用設計選項（Design Option）使設計能被完善的考慮，而當我們設計了一段時間之後，在同一個模型檔案中，可能有好幾個不同的設計選項。在Revit的預設中，在同一個視圖裡，可以呈現選擇在選項群組的某一設計選項。或選擇自動，也就是所呈現的會是依據當下編輯的選項內容。但這有一盲點，我們無法在同一視圖中，區分介於不同設計選項群組中的物件，如果它們在於其他個方面都類似，譬如，都屬同種類（Category）且同類型（Type）。
我們可簡單地寫一個指令來解決這個問題。</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">FitColorOfOptionElement</span><span class="bp">()</span> <span class="k">as</span> <span class="n">this</span> <span class="p">=</span>
  <span class="k">interface</span> <span class="nc">IExternalCommand</span> <span class="k">with</span>
    <span class="k">member</span> <span class="n">x</span><span class="p">.</span><span class="nc">Execute</span><span class="p">(</span><span class="n">cdata</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">elset</span><span class="p">)</span> <span class="p">=</span>
      <span class="k">let</span> <span class="n">uidoc</span> <span class="p">=</span> <span class="n">cdata</span><span class="p">.</span><span class="nn">Application</span><span class="p">.</span><span class="nc">ActiveUIDocument</span>
      <span class="k">let</span> <span class="n">selected</span> <span class="p">=</span>
        <span class="k">let</span> <span class="n">col</span> <span class="p">=</span> <span class="k">new</span> <span class="nc">FilteredElementCollector</span><span class="p">(</span><span class="n">uidoc</span><span class="p">.</span><span class="nc">Document</span><span class="p">,</span> <span class="n">uidoc</span><span class="p">.</span><span class="nn">ActiveView</span><span class="p">.</span><span class="nc">Id</span><span class="p">)</span>
        <span class="n">col</span><span class="p">.</span><span class="nc">WhereElementIsNotElementType</span><span class="bp">()</span>
        <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span>
          <span class="k">fun</span> <span class="n">e</span> <span class="p">-&gt;</span> 
            <span class="k">try</span>
              <span class="k">match</span> <span class="n">e</span><span class="p">.</span><span class="nn">DesignOption</span><span class="p">.</span><span class="nn">Id</span><span class="p">.</span><span class="nc">IntegerValue</span> <span class="k">with</span>
              <span class="p">|</span> <span class="n">x</span> <span class="k">when</span> <span class="n">x</span> <span class="p">=</span> <span class="nn">ElementId</span><span class="p">.</span><span class="nn">InvalidElementId</span><span class="p">.</span><span class="nc">IntegerValue</span> <span class="p">-&gt;</span> <span class="bp">false</span>
              <span class="p">|</span> <span class="p">_</span> <span class="p">-&gt;</span> <span class="bp">true</span>
            <span class="k">with</span>
            <span class="p">|</span> <span class="o">:?</span> <span class="nc">NullReferenceException</span> <span class="p">-&gt;</span> <span class="bp">false</span>
        <span class="p">)</span>
        <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span><span class="p">(</span>
          <span class="k">fun</span> <span class="n">e</span> <span class="p">-&gt;</span> <span class="n">e</span><span class="p">.</span><span class="nc">DesignOption</span><span class="p">,</span> <span class="n">e</span>
        <span class="p">)</span>
        <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">sortBy</span><span class="p">(</span><span class="k">fun</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="o">_)</span> <span class="p">-&gt;</span> <span class="n">o</span><span class="p">.</span><span class="nn">Id</span><span class="p">.</span><span class="nc">IntegerValue</span><span class="p">)</span>
      <span class="k">match</span> <span class="n">selected</span> <span class="p">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">ofSeq</span> <span class="k">with</span>
      <span class="p">|</span> <span class="bp">[]</span> <span class="p">-&gt;</span>
        <span class="n">msg</span> <span class="p">&lt;-</span> <span class="s2">"No DesignOption in this document"</span>
        <span class="nn">Result</span><span class="p">.</span><span class="nc">Cancelled</span>
      <span class="p">|</span> <span class="p">_</span> <span class="p">-&gt;</span>
        <span class="k">let</span> <span class="n">options</span> <span class="p">=</span>
          <span class="n">selected</span> <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="k">fun</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="o">_)</span> <span class="p">-&gt;</span> <span class="n">o</span><span class="p">)</span> <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">distinctBy</span><span class="p">(</span><span class="k">fun</span> <span class="n">o</span> <span class="p">-&gt;</span> <span class="n">o</span><span class="p">.</span><span class="nn">Id</span><span class="p">.</span><span class="nc">IntegerValue</span><span class="p">)</span>
        <span class="k">let</span> <span class="n">colors</span> <span class="p">=</span>
          <span class="n">options</span> 
          <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">indexed</span>
          <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span><span class="p">(</span>
            <span class="k">fun</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span> <span class="p">-&gt;</span> 
              <span class="k">let</span> <span class="n">ratio</span> <span class="p">=</span> <span class="kt">float</span> <span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span> <span class="p">(</span><span class="nn">Seq</span><span class="p">.</span><span class="n">length</span> <span class="n">options</span><span class="o">))</span>
              <span class="k">let</span> <span class="n">color</span> <span class="p">=</span> <span class="k">new</span> <span class="nc">Color</span><span class="p">(</span><span class="n">byte</span> <span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="mi">255</span><span class="p">.</span><span class="mi">0</span> <span class="p">*</span> <span class="n">ratio</span><span class="o">)),</span> <span class="n">byte</span> <span class="mi">128</span><span class="p">,</span> <span class="n">byte</span> <span class="mi">250</span><span class="p">)</span>
              <span class="k">let</span> <span class="n">ogs</span> <span class="p">=</span> <span class="k">new</span> <span class="nc">OverrideGraphicSettings</span><span class="bp">()</span>
              <span class="n">ogs</span><span class="p">.</span><span class="nc">SetCutLineColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
              <span class="n">ogs</span><span class="p">.</span><span class="nc">SetCutFillColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
              <span class="n">ogs</span><span class="p">.</span><span class="nc">SetProjectionLineColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
              <span class="n">ogs</span><span class="p">.</span><span class="nc">SetProjectionFillColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
              <span class="n">o</span><span class="p">,</span> <span class="n">ogs</span>
          <span class="p">)</span>
        <span class="k">let</span> <span class="n">t</span> <span class="p">=</span> <span class="k">new</span> <span class="nc">Transaction</span><span class="p">(</span><span class="n">uidoc</span><span class="p">.</span><span class="nc">Document</span><span class="p">,</span> <span class="kt">string</span> <span class="n">this</span><span class="p">)</span>
        <span class="n">t</span><span class="p">.</span><span class="nc">Start</span><span class="bp">()</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
        <span class="n">selected</span>
        <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">iter</span><span class="p">(</span>
          <span class="k">fun</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">-&gt;</span>
            <span class="k">let</span> <span class="o">_,</span> <span class="n">ogs</span> <span class="p">=</span> 
              <span class="n">colors</span> 
              <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="k">fun</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="o">_)</span> <span class="p">-&gt;</span> <span class="n">opt</span><span class="p">.</span><span class="nn">Id</span><span class="p">.</span><span class="nc">IntegerValue</span> <span class="p">=</span> <span class="n">o</span><span class="p">.</span><span class="nn">Id</span><span class="p">.</span><span class="nc">IntegerValue</span><span class="p">)</span>
            <span class="n">uidoc</span><span class="p">.</span><span class="nn">ActiveView</span><span class="p">.</span><span class="nc">SetElementOverrides</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nc">Id</span><span class="p">,</span> <span class="n">ogs</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">t</span><span class="p">.</span><span class="nc">Commit</span><span class="bp">()</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
        <span class="nn">Result</span><span class="p">.</span><span class="nc">Succeeded</span></code></pre></figure>

<p>Note, when we try to filter those elements, belonging to design options, we might confront the <code class="language-plaintext highlighter-rouge">System.NullReferenceException</code> error, if the elements cannot belong to any design option – such as detail lines, and we can handle it with “try… with” to avoid program crash (line 16). If the elements can belong to a design option but not, the id of its DesignOption parameter can be compared with InvalidElementId to be sorted. The next point is how to assign an override setting to a certain element; now the OverrideGraphicSettings would be useful (line41). This usage is similar to the way in Revit interface. After initialization of the OverrideGraphicSettings, its methods contain the setting available in Revit as well: CutLineColor, CutLinePattern… etc. In our example, we want to change the color of elements, for which we need to set color (line 40). Finally, assign these overriding settings to each of the design option elements in the current active view (line 56), and according to their distinguish design options, they will appear with different red tones in the RGB value.</p>

<p>在此，要注意的是，當我們篩選在設計選項的物件時，如果此物件依照它的屬性不能歸類於任何一設計選項時（例如細部線），我們會碰上 <code class="language-plaintext highlighter-rouge">System.NullReferenceExeception</code> 的錯誤。這時，可以用 try… with 來處理（16行）。而如果是可以歸類於設計選項，但並沒有被歸類，則可用判斷它的設計選項是否有無效的識別碼 InvalidElementId 來篩選。接下來的重點是，如何賦予特定的物件，特定的圖形取代；這時，OverrideGraphicSettings 將派上用場（41行）。這與我們在Revit中使用圖形取代時，是一樣的方法。在初使化 OverrideGraphicSetting 後，在其底下有與在Revit中一樣的設定：CutLineColor, CutLinePattern…等等，在此範例，我們要的是不同的顏色，將需要顏色的設定（40行）。最後，將此設定在現下的視圖中賦予各個物件（56行），依據它們不同的設計選項，將呈現不同的 RGB 紅色層級以作示範。</p>

  </div><a class="u-url" href="/revitexternalcommand/View-Control-for-Design-Option-Elements/" hidden></a>
</article>
<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="chings" data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting!" data-color="#8564a2" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">tailor . your . bim</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>© 2025 Chings e.U.</li>
          <li class="p-name">Ching</li><li><a class="u-email" href="mailto:info@tailoryourbim.com">info@tailoryourbim.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/chings-eu"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">chings-eu</span></a></li><li><a href="https://www.linkedin.com/in/tailoryourbim"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">tailoryourbim</span></a></li><li><a href="https://www.twitter.com/tailoryourbim"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">tailoryourbim</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>I&#39;m Ching, your BIM tailor.</p>
      </div>
    </div>

  </div>

</footer>
</body>
  <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="chings" data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting!" data-color="#8564a2" data-position="Right" data-x_margin="18" data-y_margin="18"></script>

</html>
