<!DOCTYPE html>
<html lang="en"><head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-5QTTTRNC1H"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-5QTTTRNC1H');
  </script>

  <meta property="og:image" content="https://discordapp.com/assets/ba74954dde74ff40a32ff58069e78c36.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="250">
  <meta property="og:image:height" content="250">

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Find Summed Area Of Rooms 房間面積總和 | tailor . your . bim</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Find Summed Area Of Rooms 房間面積總和" />
<meta name="author" content="Ching" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Got wishes for an improved BIM workflow and environment? Make all your efforts for planing projects, let us tailor your BIM to meet your needs." />
<meta property="og:description" content="Got wishes for an improved BIM workflow and environment? Make all your efforts for planing projects, let us tailor your BIM to meet your needs." />
<link rel="canonical" href="http://localhost:4000/revitexternalcommand/Find-Summed-Area-Of-Rooms/" />
<meta property="og:url" content="http://localhost:4000/revitexternalcommand/Find-Summed-Area-Of-Rooms/" />
<meta property="og:site_name" content="tailor . your . bim" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-10-20T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Find Summed Area Of Rooms 房間面積總和" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ching"},"dateModified":"2018-10-20T00:00:00+02:00","datePublished":"2018-10-20T00:00:00+02:00","description":"Got wishes for an improved BIM workflow and environment? Make all your efforts for planing projects, let us tailor your BIM to meet your needs.","headline":"Find Summed Area Of Rooms 房間面積總和","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/revitexternalcommand/Find-Summed-Area-Of-Rooms/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/logoty.png"},"name":"Ching"},"url":"http://localhost:4000/revitexternalcommand/Find-Summed-Area-Of-Rooms/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
  <link rel="shortcut icon" type="image/png" href="assets/img/favicon.png"<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="tailor . your . bim" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><!-- <a class="site-title" rel="author" href="/">tailor . your . bim</a> -->

    <a class="site-title" rel="author" href="/">
      <img src="/assets/img/logoty.png" alt="Logo" width="28px"> 
      <span>       </span>
      <!-- <span style='color: {{ site.colors.t }};'>t</span>ailor . <span style='color: {{ site.colors.y }};'>y</span>our . bim -->
      <span style='color: #B042FF;'>T</span>
      <span style='color: #939393;'>ailor . </span>
      <span style='color: #01bbd4;'>Y</span>
      <span style='color: #939393;'>our . BIM </span>
    </a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/categories/">Categories</a><a class="page-link" href="/contact/">Contact</a><a class="page-link" href="/tags/">Tags</a></div>
      </nav></div>
</header>

<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Find Summed Area Of Rooms | 房間面積總和</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-10-20T00:00:00+02:00" itemprop="datePublished">Oct 20, 2018
      </time></p>
  </header>

  <div class="post-categories"><a herf="/categories/#RevitExternalCommand">RevitExternalCommand</a>&nbsp;|&nbsp;<a herf="/tags/#f#">f#</a>&nbsp;/&nbsp;<a herf="/tags/#revit api">revit api</a>&nbsp;/&nbsp;<a herf="/tags/#sum">sum</a>&nbsp;/&nbsp;<a herf="/tags/#area">area</a>&nbsp;/&nbsp;<a herf="/tags/#room">room</a></div>
  
  <div class="post-content e-content" itemprop="articleBody">
    <script src="/assets/signup/signup.js"></script>

<signup-component></signup-component>

<p>下一個指令其實相當簡單的。上一次我們說過，該如何從簡單的曲線選取，指令的輸入，快速地取得曲線的長度總和。而我們這一次要做的其實很類似。假設我們想要快速地知道，好幾個空間的面積總和。這個可以用在當我們做建築內空間規劃時，想要快速的知道分區面積總合，是否超過最大的法規規定防火分區面積。在Revit API中，面積之於空間，就好比長度之於曲線，是一個它的相當簡單的預設參數。</p>

<p>The following command is actually quite simple. In the last entry we talked about efficiently pre-selecting curves, then running the external command and retrieve the sum of the line lengths. What we are going to do this time is similar. Say, we want to know instantly the sum of areas from different rooms. This is quite useful, when planning the fire compartments we want to be sure that it does not exceed the limit by the law. In Revit API, an area of a room is in the API’s structure similar to as a length to a curve. It is a pre-set parameter.</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">FindSumAreaOfRooms</span><span class="bp">()</span> <span class="k">as</span> <span class="n">this</span> <span class="p">=</span> 
  <span class="k">interface</span> <span class="nc">IExternalCommand</span> <span class="k">with</span>
    <span class="k">member</span> <span class="n">x</span><span class="p">.</span><span class="nc">Execute</span><span class="p">(</span><span class="n">cdata</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">elset</span><span class="p">)</span> <span class="p">=</span>
      <span class="k">let</span> <span class="n">uidoc</span> <span class="p">=</span> <span class="n">cdata</span><span class="p">.</span><span class="nn">Application</span><span class="p">.</span><span class="nc">ActiveUIDocument</span>
      <span class="k">let</span> <span class="n">selected</span> <span class="p">=</span>
        <span class="n">uidoc</span><span class="p">.</span><span class="nn">Selection</span><span class="p">.</span><span class="nc">GetElementIds</span><span class="bp">()</span> 
        <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="n">uidoc</span><span class="p">.</span><span class="nn">Document</span><span class="p">.</span><span class="nc">GetElement</span>
        <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span>
          <span class="k">fun</span> <span class="n">e</span> <span class="p">-&gt;</span>
            <span class="k">match</span> <span class="n">e</span> <span class="k">with</span>
            <span class="p">|</span> <span class="o">:?</span> <span class="nc">Room</span> <span class="p">-&gt;</span> <span class="bp">true</span>
            <span class="p">|</span> <span class="p">_</span> <span class="p">-&gt;</span> <span class="bp">false</span>
        <span class="p">)</span> <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">cast</span><span class="p">&lt;</span><span class="nc">Room</span><span class="p">&gt;</span> <span class="p">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">ofSeq</span>
      <span class="k">match</span> <span class="n">selected</span> <span class="k">with</span>
      <span class="p">|</span> <span class="bp">[]</span> <span class="p">-&gt;</span> 
        <span class="n">msg</span> <span class="p">&lt;-</span> <span class="s2">"Select Room(s)."</span>
        <span class="nn">Result</span><span class="p">.</span><span class="nc">Cancelled</span>
      <span class="p">|</span> <span class="p">_</span> <span class="p">-&gt;</span>
        <span class="k">let</span> <span class="n">txt</span> <span class="p">=</span>
          <span class="k">let</span> <span class="n">unitareas</span> <span class="p">=</span>
            <span class="n">selected</span> 
            <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span><span class="p">(</span>
              <span class="k">fun</span> <span class="n">rm</span> <span class="p">-&gt;</span> 
                <span class="n">fsMath</span><span class="p">.</span><span class="n">toCurrentUnits</span> <span class="n">uidoc</span><span class="p">.</span><span class="nc">Document</span> <span class="mi">2</span><span class="p">.</span><span class="mi">0</span> <span class="n">rm</span><span class="p">.</span><span class="nc">Area</span>
            <span class="p">)</span>
          <span class="k">let</span> <span class="n">uSys</span><span class="p">,</span> <span class="n">area</span> <span class="p">=</span> 
            <span class="n">unitareas</span> <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">head</span> 
            <span class="p">|&gt;</span> <span class="k">fun</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="o">_)</span> <span class="p">-&gt;</span> <span class="n">u</span><span class="p">,</span> <span class="n">unitareas</span> 
            <span class="p">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">sumBy</span><span class="p">(</span><span class="k">fun</span><span class="o">(_,</span><span class="n">a</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">a</span><span class="p">)</span>
          <span class="k">match</span> <span class="n">uSys</span> <span class="k">with</span>
          <span class="p">|</span> <span class="n">fsMath</span><span class="p">.</span><span class="nc">Metric</span> <span class="p">-&gt;</span>
            <span class="n">area</span> <span class="p">|&gt;</span> <span class="n">fsMath</span><span class="p">.</span><span class="n">toRoundUp</span> <span class="mi">4</span><span class="p">.</span><span class="mi">0</span> <span class="p">|&gt;</span> <span class="kt">string</span> <span class="p">|&gt;</span> <span class="k">fun</span> <span class="n">s</span> <span class="p">-&gt;</span> <span class="n">s</span> <span class="o">+</span> <span class="s2">" m²"</span>
          <span class="p">|</span> <span class="n">fsMath</span><span class="p">.</span><span class="nc">Imperial</span> <span class="p">-&gt;</span>
            <span class="n">area</span> <span class="p">|&gt;</span> <span class="n">fsMath</span><span class="p">.</span><span class="n">toRoundUp</span> <span class="mi">4</span><span class="p">.</span><span class="mi">0</span> <span class="p">|&gt;</span> <span class="kt">string</span> <span class="p">|&gt;</span> <span class="k">fun</span> <span class="n">s</span> <span class="p">-&gt;</span> <span class="n">s</span> <span class="o">+</span> <span class="s2">" sq. ft"</span>
        <span class="nn">TaskDialog</span><span class="p">.</span><span class="nc">Show</span><span class="p">(</span><span class="kt">string</span> <span class="n">this</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
        <span class="nn">Result</span><span class="p">.</span><span class="nc">Succeeded</span></code></pre></figure>

<p>我們在這裡可以清楚的看到跟之前的不同處。基本的不同點是：這裏當我們過濾預先選取的物件，比較其是否為空間種類。而當我們要得到面積總和，我們尋找的是空間的面積參數。其餘的過程其實是很相似的。譬如，根據文件的單位在決定是否轉換單位為公尺或保留為英尺（API的預設單位為英制）。但也就是因為相似，我們可以把一樣的過程寫成一模距，然後在其他指令中重複使用。</p>

<p>We can see clearly the difference. The basic ones are: We filter the pre-selected elements by their categories to see if it is room, and when we want to have the sum of areas, we search for the area parameter of rooms. The rest of the process is actually similar. For example, according to the units of the document to decide if we convert the value to meters or keep it in feet (the default units of API is imperial.) The similarity is the reason that we can manage the same process into a module and re-use the module in the other commands.</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">module</span> <span class="n">fsMath</span>
<span class="k">type</span> <span class="nc">Units</span> <span class="p">=</span>
  <span class="p">|</span> <span class="nc">Metric</span>
  <span class="p">|</span> <span class="nc">Imperial</span>
<span class="k">let</span> <span class="n">toCurrentUnits</span> <span class="p">(</span><span class="n">doc</span><span class="p">:</span><span class="nn">Autodesk</span><span class="p">.</span><span class="nn">Revit</span><span class="p">.</span><span class="nn">DB</span><span class="p">.</span><span class="nc">Document</span><span class="o">)(</span><span class="n">pow</span><span class="p">:</span><span class="kt">float</span><span class="o">)(</span><span class="n">ft</span><span class="p">:</span><span class="kt">float</span><span class="p">)</span> <span class="p">=</span>
  <span class="k">let</span> <span class="n">units</span> <span class="p">=</span> <span class="n">doc</span><span class="p">.</span><span class="nc">GetUnits</span><span class="bp">()</span>
  <span class="k">let</span> <span class="n">ut</span> <span class="p">=</span> <span class="nn">Autodesk</span><span class="p">.</span><span class="nn">Revit</span><span class="p">.</span><span class="nn">DB</span><span class="p">.</span><span class="nn">UnitType</span><span class="p">.</span><span class="nc">UT_Length</span>
  <span class="k">let</span> <span class="n">fo</span> <span class="p">=</span> <span class="n">units</span><span class="p">.</span><span class="nc">GetFormatOptions</span><span class="p">(</span><span class="n">ut</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">du</span> <span class="p">=</span> <span class="n">fo</span><span class="p">.</span><span class="nc">DisplayUnits</span>
  <span class="k">match</span> <span class="nn">Array</span><span class="p">.</span><span class="n">contains</span> <span class="s2">"METERS"</span> <span class="o">((</span><span class="kt">string</span> <span class="n">du</span><span class="o">).</span><span class="nc">Split</span> <span class="k">'</span><span class="p">_</span><span class="k">'</span><span class="p">)</span> <span class="k">with</span>
  <span class="p">|</span> <span class="bp">true</span> <span class="p">-&gt;</span> <span class="nc">Metric</span><span class="p">,</span> <span class="n">ft</span> <span class="p">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">3048</span><span class="o">**</span><span class="n">pow</span>
  <span class="p">|</span> <span class="bp">false</span> <span class="p">-&gt;</span> <span class="nc">Imperial</span><span class="p">,</span> <span class="n">ft</span>
<span class="k">let</span> <span class="n">toRoundUp</span> <span class="p">(</span><span class="n">dig</span><span class="p">:</span><span class="kt">float</span><span class="o">)(</span><span class="n">n</span><span class="p">:</span><span class="kt">float</span><span class="p">)</span> <span class="p">=</span>
  <span class="nn">System</span><span class="p">.</span><span class="nn">Math</span><span class="p">.</span><span class="nc">Round</span> <span class="p">(</span><span class="n">n</span> <span class="p">*</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span> <span class="o">**</span> <span class="n">dig</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span><span class="p">.</span><span class="mi">0</span> <span class="o">**</span> <span class="n">dig</span><span class="p">)</span></code></pre></figure>

<p>程式的詳述還是用原文英文來解釋會比較清楚。
This module has one type and two functions. This type, called discriminated union, has two cases, metric or imperial. In the first function we have three arguments: Revit document, power and dimension in feet, and the function finds whether this document is using metric or imperial system and by given value of the power argument to return one of the union cases with the converted dimension value – depending on the value of power, if the power is 1.0, it’s linear, between meter and foot; if it is 2.0, then it’s of areas, between square meter and square foot, and so on and so forth. The second function rounds a number up, according to the digit value. These three have been used in our main code. You can also try to improve our last code by implementing them in the similar way.</p>

  </div><a class="u-url" href="/revitexternalcommand/Find-Summed-Area-Of-Rooms/" hidden></a>
</article>
<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="chings" data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting!" data-color="#8564a2" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">tailor . your . bim</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>© 2025 Chings e.U.</li>
          <li class="p-name">Ching</li><li><a class="u-email" href="mailto:info@tailoryourbim.com">info@tailoryourbim.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/chings-eu"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">chings-eu</span></a></li><li><a href="https://www.linkedin.com/in/tailoryourbim"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">tailoryourbim</span></a></li><li><a href="https://www.twitter.com/tailoryourbim"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">tailoryourbim</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Got wishes for an improved BIM workflow and environment? Make all your efforts for planing projects, let us tailor your BIM to meet your needs.</p>
      </div>
    </div>

  </div>

</footer>
</body>
  <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="chings" data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting!" data-color="#8564a2" data-position="Right" data-x_margin="18" data-y_margin="18"></script>

</html>
